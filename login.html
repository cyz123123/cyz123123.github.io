<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºæ…§å†œä¸š - ç™»å½•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 400px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
      border-radius: 15px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      margin-bottom: 15px;
    }

    .logo h1 {
      font-size: 24px;
      font-weight: 600;
      color: #1d1d1f;
      margin-bottom: 5px;
    }

    .logo p {
      font-size: 14px;
      color: #86868b;
    }

    .tabs {
      display: flex;
      background: #f5f5f7;
      border-radius: 10px;
      padding: 4px;
      margin-bottom: 30px;
    }

    .tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      border: none;
      background: transparent;
      font-size: 14px;
      font-weight: 500;
      color: #86868b;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .tab.active {
      background: #fff;
      color: #1d1d1f;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .form-container {
      position: relative;
    }

    .form {
      display: none;
    }

    .form.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #1d1d1f;
      margin-bottom: 8px;
    }

    .input-group input {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #d2d2d7;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      outline: none;
    }

    .input-group input:focus {
      border-color: #0071e3;
      box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.2);
    }

    .input-group input::placeholder {
      color: #86868b;
    }

    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #0071e3 0%, #0077ed 100%);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 113, 227, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .divider {
      display: flex;
      align-items: center;
      margin: 25px 0;
      color: #86868b;
      font-size: 13px;
    }

    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #d2d2d7;
    }

    .divider span {
      padding: 0 15px;
    }

    .message {
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 14px;
      margin-bottom: 20px;
      display: none;
    }

    .message.error {
      background: #fef0f0;
      color: #ff3b30;
      border: 1px solid #ffcdd2;
      display: block;
    }

    .message.success {
      background: #f0fdf4;
      color: #34c759;
      border: 1px solid #bbf7d0;
      display: block;
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #d2d2d7;
    }

    .footer p {
      font-size: 12px;
      color: #86868b;
    }

    .footer a {
      color: #0071e3;
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* å“åº”å¼ */
    @media (max-width: 480px) {
      .card {
        padding: 30px 25px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="logo">
        <div class="logo-icon">ğŸŒ±</div>
        <h1>æ™ºæ…§å†œä¸šç›‘æµ‹ç³»ç»Ÿ</h1>
        <p>ç™»å½•ä»¥è®¿é—®æ‚¨çš„ç›‘æµ‹ç»ˆç«¯</p>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="login">ç™»å½•</button>
        <button class="tab" data-tab="register">æ³¨å†Œ</button>
      </div>

      <div id="message" class="message"></div>

      <div class="form-container">
        <!-- ç™»å½•è¡¨å• -->
        <form id="loginForm" class="form active">
          <div class="input-group">
            <label for="loginUsername">ç”¨æˆ·å</label>
            <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
          </div>
          <div class="input-group">
            <label for="loginPassword">å¯†ç </label>
            <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " required>
          </div>
          <button type="submit" class="btn btn-primary" id="loginBtn">
            ç™»å½•
          </button>
        </form>

        <!-- æ³¨å†Œè¡¨å• -->
        <form id="registerForm" class="form">
          <div class="input-group">
            <label for="regUsername">ç”¨æˆ·å</label>
            <input type="text" id="regUsername" placeholder="4-20ä¸ªå­—ç¬¦" required minlength="4" maxlength="20">
          </div>
          <div class="input-group">
            <label for="regPassword">å¯†ç </label>
            <input type="password" id="regPassword" placeholder="è‡³å°‘6ä¸ªå­—ç¬¦" required minlength="6">
          </div>
          <div class="input-group">
            <label for="regConfirm">ç¡®è®¤å¯†ç </label>
            <input type="password" id="regConfirm" placeholder="å†æ¬¡è¾“å…¥å¯†ç " required>
          </div>
          <div class="input-group">
            <label for="regNickname">æ˜µç§°ï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="regNickname" placeholder="æ‚¨çš„æ˜¾ç¤ºåç§°">
          </div>
          <button type="submit" class="btn btn-primary" id="registerBtn">
            æ³¨å†Œ
          </button>
        </form>
      </div>

      <div class="footer">
        <p>Â© 2024 æ™ºæ…§å†œä¸šç›‘æµ‹ç³»ç»Ÿ</p>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:8080/api';
    const tabs = document.querySelectorAll('.tab');
    const forms = document.querySelectorAll('.form');
    const messageEl = document.getElementById('message');

    // åˆ‡æ¢æ ‡ç­¾
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const target = tab.dataset.tab;
        tabs.forEach(t => t.classList.remove('active'));
        forms.forEach(f => f.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(target + 'Form').classList.add('active');
        hideMessage();
      });
    });

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(text, type) {
      messageEl.textContent = text;
      messageEl.className = 'message ' + type;
    }

    function hideMessage() {
      messageEl.className = 'message';
    }

    // è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€
    function setLoading(btn, loading) {
      if (loading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>å¤„ç†ä¸­...';
      } else {
        btn.disabled = false;
        btn.textContent = btn.id === 'loginBtn' ? 'ç™»å½•' : 'æ³¨å†Œ';
      }
    }

    // ç™»å½•
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      if (!username || !password) {
        showMessage('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ', 'error');
        return;
      }

      setLoading(btn, true);
      hideMessage();

      try {
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();

        if (data.success) {
          showMessage('ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...', 'success');
          // ä¿å­˜ç™»å½•ä¿¡æ¯
          localStorage.setItem('user', JSON.stringify(data.user));
          localStorage.setItem('token', data.token || '');
          // è·³è½¬åˆ°ä¸»é¡µ
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1000);
        } else {
          showMessage(data.message || 'ç™»å½•å¤±è´¥', 'error');
        }
      } catch (err) {
        showMessage('æ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿åç«¯å·²å¯åŠ¨', 'error');
      } finally {
        setLoading(btn, false);
      }
    });

    // æ³¨å†Œ
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('registerBtn');
      const username = document.getElementById('regUsername').value.trim();
      const password = document.getElementById('regPassword').value;
      const confirm = document.getElementById('regConfirm').value;
      const nickname = document.getElementById('regNickname').value.trim();

      if (!username || !password) {
        showMessage('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ', 'error');
        return;
      }

      if (password !== confirm) {
        showMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
        return;
      }

      if (password.length < 6) {
        showMessage('å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦', 'error');
        return;
      }

      setLoading(btn, true);
      hideMessage();

      try {
        const res = await fetch(`${API_BASE}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password, nickname })
        });
        const data = await res.json();

        if (data.success) {
          showMessage('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•', 'success');
          // åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾
          setTimeout(() => {
            tabs[0].click();
            document.getElementById('loginUsername').value = username;
          }, 1500);
        } else {
          showMessage(data.message || 'æ³¨å†Œå¤±è´¥', 'error');
        }
      } catch (err) {
        showMessage('æ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿åç«¯å·²å¯åŠ¨', 'error');
      } finally {
        setLoading(btn, false);
      }
    });

    // é¡µé¢åŠ è½½æ—¶æ¸…é™¤ä¹‹å‰çš„ç™»å½•çŠ¶æ€ï¼Œè¦æ±‚é‡æ–°ç™»å½•
    window.addEventListener('load', () => {
      // æ¸…é™¤æ—§çš„ç™»å½•ä¿¡æ¯ï¼Œå¼ºåˆ¶ç”¨æˆ·é‡æ–°ç™»å½•
      localStorage.removeItem('user');
      localStorage.removeItem('token');
    });
  </script>
</body>
</html>
